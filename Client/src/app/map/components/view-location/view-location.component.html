<ng-container *ngIf="!(loaded$ | async) && !location; else loaded">
  <section class="my-1">
    <mat-spinner class="center-element"></mat-spinner>
  </section>
</ng-container>

<ng-template #loaded>
  <ng-container *ngIf="location; else notFound">
    <mat-sidenav-container>
      <mat-sidenav class="sidenav" mode="side" [(opened)]="sidenavOpened">
        <h4>{{'Floors' | translate}}</h4>

        <section *ngFor="let floor of location.floors">
          <a mat-button [routerLink]="['/map', floor.locationId, floor.floorId]">{{floor.name}}</a>
        </section>

        <button mat-flat-button color="primary" [disabled]="creatingFloor || editingFloor || requesting" (click)="creatingFloor = true">
          {{'AddFloor' | translate}}
        </button>
      </mat-sidenav>

      <mat-sidenav-content class="sidenav-content">
        <section class="floor-header">
          <button mat-button (click)="toggleSidenav()">
            <mat-icon>{{sidenavOpened ? 'chevron_left' : 'chevron_right'}}</mat-icon>
          </button>

          <div class="flex-spacer"></div>

          <ng-container *ngIf="location.canEdit && selectedFloor && !creatingFloor && !editingFloor">
            <button class="action-button" mat-icon-button [disabled]="requesting" (click)="editFloor()">
              <mat-icon>edit</mat-icon>
            </button>

            <button class="action-button" mat-icon-button [disabled]="requesting" (click)="deleteFloor()">
              <mat-icon>delete</mat-icon>
            </button>
          </ng-container>
        </section>

        <app-view-floor
          *ngIf="selectedFloor && !creatingFloor && !editingFloor"
          [floor]="selectedFloor"
        ></app-view-floor>

        <app-create-floor
          *ngIf="creatingFloor || editingFloor"
          (cancel)="cancelCreateFloor()"
          (floorCreated)="reloadLocation(editingFloor ? selectedFloor.floorId : undefined)"
          [floor]="editingFloor ? selectedFloor : undefined"
          [isCancelVisible]="true"
          [labelOk]="labelOk"
          [locationId]="location.locationId"
          [labelErrorOccurred]="labelErrorOccurred"
        ></app-create-floor>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </ng-container>
</ng-template>

<ng-template #notFound>
  <h2 class="text-center">{{'NotFoundLocation' | translate}}</h2>
</ng-template>
